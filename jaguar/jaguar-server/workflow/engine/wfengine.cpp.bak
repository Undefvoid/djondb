#include "wfruntime.h"

using namespace cache;

// creates a new instance from the process definition
ProcessInstance* createProcessInstance(long definition)
{
    ProcessInstance* processInstance = new ProcessInstance();
    CacheGroup cache = getGlobalCache("METADATA");
    map<long, ProcessDefinition*>* definitions = cache.get("PROCESSDEFINITIONS");
    ProcessDefinition* def = definitions->find(
    processInstance.setProcessDefinition(def);
    //MasterEntity master = getMasterEntity(def);
    //processInstance.setMasterEntity(master);
    List<StartEvent> startEvents = getStartEvents(def);
for (StartEvent evt : startEvents)
    {
        processInstance = processEvent(processInstance, evt);
    }
    processInstance = (ProcessInstance) persist(processInstance);

    return processInstance;
}
